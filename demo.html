<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Full Funnel & Profiles Demo</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #log {
      white-space: pre-wrap;
      background: #f8f8f8;
      padding: 10px;
      border: 1px solid #ddd;
      height: 200px;
      overflow-y: scroll;
      margin-top: 1em;
    }
    button { margin: 5px; padding: 8px 16px; font-size: 1em; }
  </style>

  <!-- Official Mixpanel SDK -->
  <script type="text/javascript">
    (function(e,a){
      if(!a.__SV){
        var b=window;try{var c,l,i,j=b.location,g=j.hash;
          c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};
          if(g&&c(g,"state")){
            i=JSON.parse(decodeURIComponent(c(g,"state")));
            "mpeditor"===i.action&&
              (b.sessionStorage.setItem("_mpcehash",g),
               history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search));
          }
        }catch(m){}
        var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){
          function d(a,b){
            var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]);
            a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}
          }
          var g=a;"undefined"!==typeof f?g=a[f]=[]:f="mixpanel";
          g.people=g.people||[];g.toString=function(a){
            var b="mixpanel";"mixpanel"!==f&&(b+="."+f);
            return a||(b+=" (stub)"),b
          };
          g.people.toString=function(){return g.toString(1)+".people (stub)"};
          k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
          for(h=0;h<k.length;h++)d(g,k[h]);
          a._i.push([b,c,f])
        };
        a.__SV=1.2;
        var script=document.createElement("script");
        script.type="text/javascript";script.async=!0;
        script.src="https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";
        var first=document.getElementsByTagName("script")[0];
        first.parentNode.insertBefore(script,first);
      }
    })(document,window.mixpanel||[]);
    // Initialize with your token
    mixpanel.init("3fa2c64f2b6a4115e5407bd26b1ca9c3");
  </script>
</head>

<body>
  <h1>Full Funnel & Profiles Demo</h1>
  <button id="pageview">Page View</button>
  <button id="viewproduct" disabled>View Product</button>
  <button id="addtocart" disabled>Add to Cart</button>
  <button id="startcheckout" disabled>Start Checkout</button>
  <button id="purchase" disabled>Purchase</button>

  <h2>Event Log</h2>
  <div id="log">Ready…</div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let uid = null;
      // Random user properties for demo
      const cities    = ["Lagos","New York","London","Berlin","Tokyo"],
            countries = ["Nigeria","USA","UK","Germany","Japan"],
            styles    = ["B2C","B2B","Hybrid"];
      const city    = cities[Math.floor(Math.random()*cities.length)],
            country = countries[Math.floor(Math.random()*countries.length)],
            style   = styles[Math.floor(Math.random()*styles.length)];

      const log = msg => {
        console.log(msg);
        const el = document.getElementById('log');
        el.textContent += msg + '\n';
        el.scrollTop = el.scrollHeight;
      };

      // Utility to identify & set profile
      function createProfile(id) {
        mixpanel.identify(id);
        mixpanel.people.set({
          $name: id,
          city: city,
          country: country,
          operating_style: style
        });
        log(`Profile set for ${id}: ${city}, ${country}, ${style}`);
      }

      document.getElementById('pageview').onclick = () => {
        // generate a new user
        uid = 'user_' + Math.floor(Math.random()*100000);
        createProfile(uid);
        mixpanel.track('Page View', { distinct_id: uid });
        log(`Tracked: Page View → {"distinct_id":"${uid}"}`);
        document.getElementById('viewproduct').disabled = false;
      };

      document.getElementById('viewproduct').onclick = () => {
        mixpanel.track('View Product',    { distinct_id: uid, product_id: 'prod_1' });
        log('Tracked: View Product');
        document.getElementById('addtocart').disabled = false;
      };

      document.getElementById('addtocart').onclick = () => {
        mixpanel.track('Add to Cart',     { distinct_id: uid, qty: 1 });
        log('Tracked: Add to Cart');
        document.getElementById('startcheckout').disabled = false;
      };

      document.getElementById('startcheckout').onclick = () => {
        mixpanel.track('Start Checkout',  { distinct_id: uid });
        log('Tracked: Start Checkout');
        document.getElementById('purchase').disabled = false;
      };

      document.getElementById('purchase').onclick = () => {
        mixpanel.track('Purchase Completed',{ distinct_id: uid, revenue: 49.99 });
        log('Tracked: Purchase Completed');
        // disable all after purchase
        ['pageview','viewproduct','addtocart','startcheckout','purchase']
          .forEach(id => document.getElementById(id).disabled = true);
      };
    });
  </script>
</body>
</html>
